<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <script src="./assets/react.js"></script>
  <script src="./assets/react-dom.js"></script>
  <script src="./assets/babel.js"></script>
  <script src="./assets/jquery-3.6.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/antd/4.18.2/antd.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/antd/4.18.2/antd.compact.min.css">
</head>

<body>
  <div id="updateAppTip"></div>
</body>
<script type="text/babel">
  const { ipcRenderer } = require('electron');
  const MessageBox = () => {
    const [updateMessage, setUpdateMessage] = React.useState({});
    const [startUpdate, setStartUpdate] = React.useState('');

    ipcRenderer.on('updateMessage', (event, message) => {
      console.log('接收到更新进度', message);
      setUpdateMessage({
        size: message.files[0].size / (1024 * 1024),
        version: message.version,
        releaseNotes: message.releaseNotes
      });
    });

    ipcRenderer.on('startUpdate', (event, message) => {
      setStartUpdate(message);
    })
    //稍后更新
    const onClickLater = () => {
      ipcRenderer.send('update-close');
    }
    //立即更新
    const onStartUpdate = () => {
      ipcRenderer.send('start-update');
    }
    return (
      <div id="contreBox">
        <img id="updateLogo" src="./assets/img/mella.png" alt="" height="112px" />
        <p id="title">{`发现新版本${updateMessage.version}(${updateMessage.size ? updateMessage.size.toFixed(2) : ''}M)`}</p>
        <div
          id="updateMessage"
          dangerouslySetInnerHTML={{
            __html: updateMessage.releaseNotes,
          }}
        />
        {
          // startUpdate && (
          //   <antd.Progress percent={startUpdate.percent} status="active" />
          // )
        }
        <div id="btnBox">
          <antd.Button id="btnItem" type="primary" onClick={() => onClickLater()}>Later on</antd.Button>
          <antd.Button id="btnItem" type="primary" onClick={() => onStartUpdate()}>Download now</antd.Button>
        </div>
      </div>
    )
  };

  ReactDOM.render(<MessageBox />, document.getElementById('updateAppTip'))
</script>
<style>
  p {
    margin: 0;
    padding: 0;
  }

  #title,
  #updateLogo,
  #updateMessage {
    margin-bottom: 16px;
  }

  #updateAppTip {
    height: 100%;
    width: 100%;
  }

  #contreBox {
    height: 100%;
    width: 100%;
    background-color: #D5D5D5;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
  }

  /* #updateLogo {
    margin-bottom: 16px;
  }

  #updateMessage {
    margin-bottom: 16px;
  } */

  #btnItem {
    background-color: #e1206d;
    border-color: #e1206d;
    width: 120px;
    height: 32px;
    font-size: 14px;
  }

  #btnItem:nth-child(1) {
    margin-right: 32px;
  }
</style>

</html>
